{% extends "kiosk/site_base.html" %}
{% load static %}

{% block content %}
    <div id="main">
        <div id="exhibition-detail"></div>
        <div id="item-list-template"></div>

        <div id="end_exhibition_form" style="display: none;">
            <form>
                <input type="text" id="inputFullname" placeholder="fullname">
                <input type="email" id="inputEmail" placeholder="email">
                <button type="submit" class="btn">send</button>
                <div class="clearfix"></div>
            </form>
        </div>
    </div>
    <div id="sidebar-detail"></div>
{% endblock content %}

{% block extra-script %}
    <script>
        window.exhibition.pk = "{{ pk }}";
    </script>
    <script src="{% static "js/item.js" %}"></script>
    <script>
        $("#end_exhibition_form").find('button').on('click', function (e) {
            var data;

            e.preventDefault();
            e.stopPropagation();

            data = {
                "email": $('#inputEmail').val(),
                "name": $("#inputFullname").val(),
                "exhibition": "{{ pk }}",
                "posts": JSON.stringify($.map($('.item').find('.icon-star-active'), function (el) {
                    return {
                        'item_pk': $(el).closest('article').data('pk')
                    };
                }))
            };

            $.post(window.urls.story, data).done(function (r) {
                window.location.href = window.urls.kiosk;
            }).fail(function () {
                alert('Sorry, something went wrong!');
            });
        });
    </script>
{% endblock %}

{% block templates %}
    <script type="text/template" id="item_template">
        <article class="pin item" data-pk="<%= pk %>">
            <img src="<%= images[0] %>" alt="<%= name %>" />
            <i class="icon-star"></i>

            <p class="text-center"><%= name %></p>
        </article>
    </script>

    <script type="text/template" id="item_detail_template">
        <article class="item-detail" data-pk="<%= id %>">

            <h1 class="text-center">
                <span id="close-button"><i class="icon-arrow-left"></i> Chiudi</span>
                <span><%= name %></span>
            </h1>
            <h4 class="text-center"> <%= author %> <%= year %></h4>

            <div class="first-image-wrapper">
                <% if(images.length !==1) { %>
                <p class="text-center">
                    <% for(var i in images) { %>
                    <div style="position: relative; height: 70px; width: 70px; display: inline-block;">
                        <img class="other-images" src="<%= images[i] %>" alt="<%= name %>" />
                    </div>
                    <% } %>
                </p>
                <% } %>
                <div style="position: relative;">
                    <i class="icon-star <% if(active){ %>icon-star-active<% } %>"></i>
                    <img class="first-image" src="<%= images[0] %>" alt="<%= name %>" width="250" /><br>
                </div>
            </div>

            <blockquote><%= desc %></blockquote>
        </article>
    </script>

    <script type="text/template" id="exhibition_detail_template">
        <article>
            <h1 class="text-center">
                <span id="back-button"><i class="icon-arrow-left"></i> Indietro</span>
                <span><%= title %></span>
                <span id="end-button" style="display: none;">Fine <i class="icon-arrow-right"></i></span>
            </h1>
            <h4 class="text-center"><%= description %></h4>
        </article>
    </script>
{% endblock templates %}
