{% extends "kiosk/site_base.html" %}
{% load static %}

{% block content %}

    <div id="main">
        <div id="exhibition-detail"></div>
        <div id="item-list-template"></div>
    </div>
    <div id="sidebar-detail"></div>

    <div id="end_exhibition_form" style="display: none;">
        <div class="well">
            <form class="form-horizontal">
                <div class="control-group">
                    <label class="control-label" for="inputEmail">Fullname</label>

                    <div class="controls">
                        <input type="text" id="inputFullname" placeholder="Email">
                    </div>
                </div>
                <div class="control-group">
                    <label class="control-label" for="inputEmail">Email</label>

                    <div class="controls">
                        <input type="email" id="inputEmail" placeholder="Email">
                    </div>
                </div>
                <button type="submit" class="btn">Send</button>
            </form>
        </div>
    </div>

{% endblock content %}

{% block extra-script %}
    <script>
        window.exhibition.pk = "{{ pk }}";
    </script>
    <script src="{% static "js/item.js" %}"></script>
    <script>
        $("#end_exhibition_form").find('button').on('click', function (e) {
            var data;

            e.preventDefault();
            e.stopPropagation();

            data = {
                "email": $('#inputEmail').val(),
                "fullname": $("#inputFullname").val(),
                "listofpk": JSON.stringify($.map($('.item').find('.icon-star-active'), function (el) {
                    return $(el).closest('article').data('pk');
                }))
            };

            $.post(window.urls.story, data).done(function (r) {
                alert('andato a buon fine!\nid: ' + r.public_id);
                $('#end_exhibition_form').find('button')
                    .attr({disabled: true})
                    .after(
                        '<a href="' + window.urls.kiosk +
                            '" class="btn btn-danger">Done</a>' +
                            '<p>  id: ' + r.public_id + '</p>'
                    )
                // window.location.href = window.urls.kiosk;
            }).fail(function () {
                    alert('NON andato a buon fine');
                });
        });
    </script>
{% endblock %}

{% block templates %}
    <script type="text/template" id="item_template">
        <article class="pin item" data-pk="<%= pk %>">
            <img src="<%= images[0] %>" alt="<%= name %>" />
            <i class="icon-star"></i>

            <p class="text-center"><%= name %></p>
        </article>
    </script>

    <script type="text/template" id="item_detail_template">
        <article class="item-detail" data-pk="<%= id %>">

            <h1 class="text-center">
                <span id="close-button"><i class="icon-arrow-left"></i> Chiudi</span>
                <span><%= name %></span>
            </h1>
            <h4 class="text-center"> <%= author %> <%= year %></h4>

            <div class="first-image-wrapper">
                <div style="position: relative;">
                    <i class="icon-star <% if(active){ %>icon-star-active<% } %>"></i>
                    <img class="first-image" src="<%= images[0] %>" alt="<%= name %>" width="250" /><br>

                    <% if(images.length !==1) { %>
                    <p class="text-center">
                        <% for(var i in images) { %>
                        <img class="other-images" src="<%= images[i] %>" alt="<%= name %>" width="70" />
                        <% } %>
                    </p>
                    <% } %>
                </div>
            </div>

            <blockquote><%= desc %></blockquote>
        </article>
    </script>

    <script type="text/template" id="exhibition_detail_template">
        <article>
            <h1 class="text-center">
                <span id="back-button"><i class="icon-arrow-left"></i> Indietro</span>
                <span><%= title %></span>
                <span id="end-button">Fine <i class="icon-arrow-right"></i></span>
            </h1>
            <h4 class="text-center"><%= description %></h4>
        </article>
    </script>
{% endblock templates %}
